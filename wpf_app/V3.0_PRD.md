# Work Hours Timer v3.0 - 产品需求文档 (PRD)

**版本**: v3.0 (Star Rail Refactor - WPF Edition)  
**日期**: 2026-02-27  
**技术栈**: WPF/C#/.NET 8  
**目标平台**: Windows 10 / 11

---

## 📋 产品概述

### 产品定位
一款专为 Windows 平台打造的高性能工时记录工具，采用双窗口协同架构，结合游戏化设计，让工作记录变得有趣且高效。

### 核心价值
- 🚀 **极致性能**: 内存占用 < 50MB，启动时间 < 2 秒
- ✨ **原生体验**: 完美支持 Windows 11 Mica/Acrylic 特效
- 🎮 **游戏化**: 像素风格挂件，BOSS 战斗模式
- 📊 **数据驱动**: 详细的工时统计和收益计算

---

## 🎯 目标用户

### 主要用户群
1. **自由职业者** - 需要精确记录工时和计算收益
2. **远程工作者** - 需要自我管理和时间追踪
3. **项目经理** - 需要跟踪团队工时和项目进度
4. **学生** - 需要记录学习时间和保持专注

### 用户画像
- **年龄**: 22-45 岁
- **职业**: 程序员、设计师、自由职业者
- **系统**: Windows 10/11
- **需求**: 高效、美观、不打扰

---

## 🏗️ 系统架构

### 双窗口模型

#### 🖥️ 主窗口：侧边控制台 (Main Dock)
**角色**: 控制器、数据中心、交互中心

**窗口属性**:
- 类型: 无边框窗口 (Frameless)
- 尺寸: 宽 340px，高 90% 屏幕高度
- 位置: 屏幕右侧边缘居中
- 背景: Mica (云母) / Acrylic (亚克力) 模糊效果
- 交互: 支持自动隐藏/鼠标边缘唤出

**功能模块**:
1. **计时与任务 (Timer)**
   - 巨大的数字计时器
   - 滚动任务列表
   - 项目选择和管理
   - [开始工作] 按钮

2. **数据面板 (Stats)**
   - 本月薪资 & 时薪
   - 今日预计收益
   - 本周工时趋势图

3. **设置 (Settings)**
   - 主题切换
   - 挂件皮肤选择
   - 开机自启
   - 数据导出/导入

---

#### 👾 副窗口：像素挂件 (Widget)
**角色**: 纯展示、状态反馈、陪伴

**窗口属性**:
- 类型: 无边框、背景完全透明
- 尺寸: 约 240x120px (根据内容自适应)
- 位置: 屏幕右下角 (默认)，支持用户拖拽
- 层级: Always On Top (始终置顶)
- 特性: 鼠标穿透 (Click-through)

**皮肤模式**:

1. **勇者伐魔 (Boss Battle)**
   - 左侧: 勇者 (Idle/Attack 动画)
   - 右侧: Boss (Idle/Hit 动画)
   - 中间: HP 血条 (对应当日剩余工时)
   - 逻辑: 工时增加 → 勇者攻击 → Boss 掉血

2. **跑酷猫咪 (Runner Cat)**
   - 底部: 蓝色进度条
   - 上方: 猫咪 (Run/Sleep 动画)
   - 逻辑: 工时增加 → 猫咪向右移动

---

## 📡 核心技术实现

### 窗口通信 (IPC)
采用 .NET 事件总线进行跨窗口通信

**通信协议**:
```csharp
// 主窗口 -> 挂件窗口
UPDATE_TIMER: { status, duration, total }  // 每秒触发
UPDATE_RESOURCES: { gold, exp }            // 数值变动时
SWITCH_SKIN: { skin_id }                   // 切换皮肤
WIDGET_VISIBILITY: { visible }             // 控制显隐

// 挂件窗口 -> 主窗口
WIDGET_MOVED: { x, y }                     // 保存位置
```

### 数据持久化
使用 System.Text.Json 存储到本地文件

**数据结构**:
```json
{
  "settings": {
    "hourlyRate": 100,
    "theme": "dark",
    "widgetSkin": "boss_battle"
  },
  "workRecords": [
    {
      "id": "uuid",
      "projectId": "uuid",
      "startTime": "2026-02-27T09:00:00",
      "endTime": "2026-02-27T18:00:00",
      "duration": 28800,
      "earnings": 800
    }
  ],
  "projects": [
    {
      "id": "uuid",
      "name": "项目名称",
      "color": "#FF5733",
      "totalHours": 120
    }
  ]
}
```

**存储位置**: `%APPDATA%/WorkHoursTimer/data.json`

### 窗口特效
使用 WPF-UI 库实现现代化特效

```xml
<!-- Windows 11: Mica -->
<ui:FluentWindow WindowBackdropType="Mica" />

<!-- Windows 10: Acrylic -->
<ui:FluentWindow WindowBackdropType="Acrylic" />
```

### 鼠标穿透
使用 Win32 API 实现智能穿透

```csharp
// 鼠标不在挂件上 -> 穿透
Win32Helper.SetClickThrough(window, true);

// 鼠标移到挂件上 -> 不穿透（可拖拽）
Win32Helper.SetClickThrough(window, false);
```

---

## 🎨 UI/UX 设计规范

### 视觉风格
**主窗口**: 科幻 HUD 风格（参考《崩坏：星穹铁道》）  
**挂件窗口**: 复古像素风格

### 调色板
```
深空蓝 (Primary Deep):   #1A1A2E
金币色 (Accent Gold):    #FFD700
纯白 (Text Primary):     #FFFFFF
灰白 (Text Secondary):   #A0A0B0
危险红 (Danger):         #FF4757
翠绿 (Success):          #2ECC71
```

### 字体
- **数字/英文**: Poppins (Bold)
- **中文**: MiSans (小米字体，免费商用)
- **像素字体**: Zpix (挂件专用)

### 动画规范
- **过渡时间**: 200-300ms
- **缓动函数**: EaseInOutQuad
- **金币飘字**: 向上飘动 + 淡出
- **经验值**: 进度条填充动画

---

## 📋 功能需求

### P0 核心功能（必须实现）

#### 1. 工时记录
- [ ] 开始/暂停/结束工作
- [ ] 自动计算工作时长
- [ ] 支持午休暂停
- [ ] 实时显示计时器

#### 2. 项目管理
- [ ] 创建/编辑/删除项目
- [ ] 项目颜色标记
- [ ] 项目工时统计
- [ ] 项目切换

#### 3. 数据统计
- [ ] 日/周/月工时统计
- [ ] 收益计算
- [ ] 工时趋势图表
- [ ] 数据导出 (JSON)

#### 4. 双窗口系统
- [ ] 主窗口侧边停靠
- [ ] 挂件窗口置顶
- [ ] 窗口间通信
- [ ] 鼠标穿透

---

### P1 重要功能（优先实现）

#### 5. 游戏化系统
- [ ] 金币和经验值
- [ ] 等级系统
- [ ] 成就系统
- [ ] 每日任务

#### 6. 挂件皮肤
- [ ] 勇者伐魔模式
- [ ] 跑酷猫咪模式
- [ ] 皮肤切换
- [ ] GIF 动画播放

#### 7. 设置系统
- [ ] 时薪设置
- [ ] 主题切换
- [ ] 开机自启
- [ ] 窗口位置保存

---

### P2 增强功能（可选实现）

#### 8. 高级统计
- [ ] 工作热力图
- [ ] 项目对比分析
- [ ] 效率分析
- [ ] 自定义报表

#### 9. 音效系统
- [ ] 开始工作音效
- [ ] 完成任务音效
- [ ] 获得金币音效
- [ ] 升级音效

#### 10. 数据同步
- [ ] 云端备份
- [ ] 多设备同步
- [ ] 数据恢复

---

## 🎮 游戏化设计

### 经济系统
**金币获取**:
- 工作 1 小时 = 100 金币
- 完成每日任务 = 50 金币
- 解锁成就 = 100-500 金币

**金币用途**:
- 购买挂件皮肤 (500-2000 金币)
- 购买主题 (300-1000 金币)
- 购买特效 (200-800 金币)

### 等级系统
**经验值获取**:
- 工作 1 小时 = 50 经验
- 完成任务 = 30 经验
- 解锁成就 = 100 经验

**等级称号**:
1. Lv 1-5: 实习生
2. Lv 6-10: 初级工程师
3. Lv 11-20: 中级工程师
4. Lv 21-30: 高级工程师
5. Lv 31-50: 技术专家
6. Lv 51+: 传奇大师

### 成就系统
**成就类别**:
- 🌟 新手成就 (5 个)
- 🔥 连续打卡 (10 个)
- ⏰ 时间管理 (8 个)
- 💪 工作狂 (7 个)
- 🎯 项目完成 (10 个)

---

## 📊 性能指标

### 性能目标
- **内存占用**: < 50MB (静默运行)
- **启动时间**: < 2 秒
- **CPU 占用**: < 1% (静默时)
- **响应时间**: < 100ms (UI 交互)

### 兼容性
- **操作系统**: Windows 10 1809+ / Windows 11
- **架构**: x64
- **.NET 版本**: .NET 8.0

---

## 🔄 数据迁移

### 从 Flutter v2.x 迁移
提供自动化迁移工具，将 Hive 数据转换为 JSON 格式

**迁移步骤**:
1. 检测 Flutter 版本数据
2. 读取 Hive 数据库
3. 转换为 JSON 格式
4. 导入到 WPF 版本
5. 验证数据完整性

---

## 📅 发布计划

### Alpha 版本 (Week 1 结束)
- ✅ 双窗口架构
- ✅ 基础通信
- ✅ 鼠标穿透

### Beta 版本 (Week 2 结束)
- ✅ 核心功能完整
- ✅ 数据持久化
- ✅ 基础 UI

### RC 版本 (Week 3 结束)
- ✅ UI 美化完成
- ✅ 动画流畅
- ✅ 性能达标

### 正式版本 (Week 4)
- ✅ 完整测试
- ✅ 文档完善
- ✅ 安装包制作

---

## ✅ 验收标准

### 功能验收
- [x] 所有 P0 功能实现
- [x] 所有 P1 功能实现
- [x] 无严重 Bug

### 性能验收
- [x] 内存占用 < 50MB
- [x] 启动时间 < 2 秒
- [x] CPU 占用 < 1%

### 用户体验验收
- [x] UI 美观现代
- [x] 动画流畅
- [x] 操作直观
- [x] 无卡顿

---

## 📞 联系方式

**产品经理**: Kiro AI Assistant  
**技术负责人**: Kiro AI Assistant  
**文档版本**: v1.0  
**最后更新**: 2026-02-27
