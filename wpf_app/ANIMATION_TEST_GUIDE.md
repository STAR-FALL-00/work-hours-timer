# 🎮 动画系统测试指南

**日期**: 2026-02-28  
**版本**: v3.0 Alpha  
**测试重点**: PixelActor 帧动画系统

---

## 🚀 快速启动

### 方法 1: 使用批处理脚本
```bash
cd wpf_app
./build-and-run.bat
```

### 方法 2: 使用 dotnet CLI
```bash
cd wpf_app/WorkHoursTimer
dotnet run
```

---

## ✅ 测试清单

### 1. 基础动画测试

#### 1.1 勇者待机动画
- [ ] 启动应用
- [ ] 点击"创建挂件"按钮
- [ ] **预期结果**: 
  - 挂件窗口出现
  - 左侧勇者角色播放待机动画（8帧循环）
  - 动画流畅，无闪烁
  - 像素清晰，无模糊

#### 1.2 勇者攻击动画
- [ ] 在主窗口点击"开始工作"
- [ ] **预期结果**:
  - 勇者切换到攻击动画（6帧循环）
  - 切换瞬间无卡顿
  - Boss 血条开始减少

#### 1.3 动画状态切换
- [ ] 点击"暂停"按钮
- [ ] **预期结果**: 勇者切换回待机动画
- [ ] 点击"继续"按钮
- [ ] **预期结果**: 勇者切换回攻击动画
- [ ] 点击"停止"按钮
- [ ] **预期结果**: 勇者切换回待机动画，计时器归零

---

### 2. 皮肤切换测试

#### 2.1 切换到跑酷猫咪
- [ ] 右键点击挂件窗口
- [ ] 选择"切换皮肤" → "跑酷猫咪"
- [ ] **预期结果**:
  - UI 切换到猫咪模式
  - 显示猫咪角色
  - 显示进度条（0h - 4h - 8h）
  - 计时器颜色变为蓝色

#### 2.2 切换回勇者伐魔
- [ ] 右键点击挂件窗口
- [ ] 选择"切换皮肤" → "勇者伐魔"
- [ ] **预期结果**:
  - UI 切换回勇者模式
  - 显示勇者和 Boss
  - 显示 Boss 血条
  - 计时器颜色变为金色

---

### 3. 性能测试

#### 3.1 内存占用
- [ ] 打开任务管理器
- [ ] 观察 WorkHoursTimer.exe 内存占用
- [ ] **预期结果**: 
  - 初始内存 < 50MB
  - 运行 10 分钟后内存增长 < 10MB
  - 无内存泄漏

#### 3.2 CPU 占用
- [ ] 观察 CPU 占用率
- [ ] **预期结果**:
  - 待机状态 CPU < 1%
  - 动画播放时 CPU < 2%
  - 无异常 CPU 峰值

#### 3.3 长时间运行
- [ ] 让应用运行 1 小时
- [ ] **预期结果**:
  - 动画持续流畅
  - 无崩溃
  - 无卡顿
  - 无内存泄漏

---

### 4. 窗口交互测试

#### 4.1 拖拽功能
- [ ] 左键按住挂件窗口
- [ ] 拖动到屏幕不同位置
- [ ] **预期结果**:
  - 窗口跟随鼠标移动
  - 动画持续播放
  - 无卡顿

#### 4.2 置顶功能
- [ ] 右键挂件 → 取消勾选"置顶"
- [ ] 打开其他窗口
- [ ] **预期结果**: 挂件被其他窗口遮挡
- [ ] 右键挂件 → 勾选"置顶"
- [ ] **预期结果**: 挂件始终在最前

#### 4.3 关闭功能
- [ ] 右键挂件 → "关闭挂件"
- [ ] **预期结果**:
  - 挂件窗口关闭
  - 主窗口仍然运行
  - 可以再次创建挂件

---

### 5. 数据同步测试

#### 5.1 计时器同步
- [ ] 创建挂件
- [ ] 在主窗口开始工作
- [ ] **预期结果**:
  - 挂件计时器与主窗口同步
  - 时间格式一致（HH:MM:SS）
  - 无延迟

#### 5.2 资源显示
- [ ] 工作 1 小时
- [ ] **预期结果**:
  - 金币数量增加（假设时薪 100，应显示 100）
  - 经验值增加（应显示 50）
  - Boss 血量减少（应减少约 12.5%）

---

## 🐛 已知问题

### 问题 1: Boss/金币/猫咪仍为静态图
**状态**: 待扩展  
**原因**: 当前只实现了勇者的多帧动画  
**计划**: 下一阶段添加其他角色的序列帧

### 问题 2: 音效未实现
**状态**: P2 优先级  
**计划**: 下周集成 NAudio

---

## 🔍 调试技巧

### 查看动画帧加载日志
1. 在 Visual Studio 中运行（F5）
2. 打开"输出"窗口
3. 查看 Debug 输出
4. 如果帧加载失败，会显示错误信息：
   ```
   加载帧失败: /Assets/Images/..., 错误: ...
   ```

### 检查图片资源
```bash
# 查看编译后的资源
cd wpf_app/WorkHoursTimer/bin/Debug/net8.0-windows
# 资源应嵌入在 WorkHoursTimer.dll 中
```

### 手动验证帧路径
在 `WidgetViewModel.cs` 中添加断点：
```csharp
_heroIdleFrames = Enumerable.Range(0, 8)
    .Select(i => $"/Assets/Images/Hero/Hero Knight/Sprites/HeroKnight/Idle/HeroKnight_Idle_{i}.png")
    .ToArray(); // <-- 在这里设置断点
```

---

## 📊 测试报告模板

### 测试环境
- **操作系统**: Windows 11 / Windows 10
- **.NET 版本**: .NET 8.0
- **屏幕分辨率**: 1920x1080
- **DPI 缩放**: 100% / 125% / 150%

### 测试结果
| 测试项 | 状态 | 备注 |
|--------|------|------|
| 勇者待机动画 | ✅ / ❌ | |
| 勇者攻击动画 | ✅ / ❌ | |
| 状态切换 | ✅ / ❌ | |
| 皮肤切换 | ✅ / ❌ | |
| 内存占用 | ✅ / ❌ | 初始: __MB, 1小时后: __MB |
| CPU 占用 | ✅ / ❌ | 平均: __% |
| 长时间运行 | ✅ / ❌ | 运行时长: __小时 |
| 窗口拖拽 | ✅ / ❌ | |
| 数据同步 | ✅ / ❌ | |

### 发现的问题
1. 
2. 
3. 

### 改进建议
1. 
2. 
3. 

---

## 🎯 下一步测试重点

### 短期（本周）
- [ ] 添加 Boss 多帧动画并测试
- [ ] 添加金币旋转动画并测试
- [ ] 添加猫咪跑步动画并测试
- [ ] 测试多个挂件同时运行

### 中期（下周）
- [ ] 集成音效系统并测试
- [ ] 测试设置页面功能
- [ ] 测试数据持久化

### 长期（发布前）
- [ ] 压力测试（24小时连续运行）
- [ ] 多显示器测试
- [ ] 高 DPI 测试
- [ ] 低配置电脑测试

---

## 📞 反馈渠道

如果发现任何问题，请记录：
1. **问题描述**: 详细说明问题现象
2. **复现步骤**: 如何触发问题
3. **预期结果**: 应该发生什么
4. **实际结果**: 实际发生了什么
5. **截图/视频**: 如果可能，提供视觉证据
6. **日志**: 从输出窗口复制相关日志

---

**祝测试顺利！** 🎮✨
