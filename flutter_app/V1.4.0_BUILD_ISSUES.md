# v1.4.0 æ„å»ºé—®é¢˜æŠ¥å‘Š

> **æ—¥æœŸ**: 2026-02-26  
> **çŠ¶æ€**: âŒ æ„å»ºå¤±è´¥  

---

## ğŸ› å½“å‰é—®é¢˜

### ä¸»è¦é”™è¯¯

```
lib/main.dart(71,19): error G4020727C: Not a constant expression.
```

**ä½ç½®**: `flutter_app/lib/main.dart` ç¬¬71è¡Œ

**ä»£ç **:
```dart
home: appSettings.isGameMode
    ? const GameHomeScreenV12()
    : const HomeScreenV12(),
```

**é—®é¢˜åˆ†æ**:
- ç¼–è¯‘å™¨æŠ¥å‘Š"Not a constant expression"
- ä½†ä»£ç çœ‹èµ·æ¥æ˜¯æ­£ç¡®çš„
- `appSettings` æ¥è‡ª `ref.watch(appSettingsProvider)`
- è¿™æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å€¼ï¼Œä¸æ˜¯ç¼–è¯‘æ—¶å¸¸é‡
- ä½¿ç”¨ `const` æ„é€ å‡½æ•°åœ¨è¿™é‡Œå¯èƒ½ä¸åˆé€‚

---

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. floating_window_screen.dart

**é—®é¢˜**: 
- `workRecordsProvider` æœªå®šä¹‰
- `AppTextStyles.bodySmall` ç­‰ä½œä¸ºå‡½æ•°è°ƒç”¨é”™è¯¯

**ä¿®å¤**:
- ç§»é™¤äº†å¯¹ `workRecordsProvider` çš„å¼•ç”¨
- ä¿®æ”¹ä¸º `AppTextStyles.bodySmall(Brightness.dark)`

### 2. item_shop_screen.dart

**é—®é¢˜**:
- `AppColors.gold` ä¸å­˜åœ¨
- `ResourceCapsule` å‚æ•°é”™è¯¯

**ä¿®å¤**:
- ä½¿ç”¨ `AppColors.accent` ä»£æ›¿ `AppColors.gold`
- ä¿®æ”¹ `ResourceCapsule` å‚æ•°ä¸º `type` å’Œ `current`

---

## ğŸ” å°è¯•çš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ç§»é™¤ const
```dart
home: appSettings.isGameMode
    ? GameHomeScreenV12()
    : HomeScreenV12(),
```

**ç»“æœ**: å¤±è´¥ï¼ŒæŠ¥å‘Š"The method 'GameHomeScreenV12' isn't defined"

### æ–¹æ¡ˆ 2: æ¸…ç†å¹¶é‡æ–°æ„å»º
```bash
flutter clean
flutter pub get
flutter run -d windows
```

**ç»“æœ**: å¤±è´¥ï¼ŒåŒæ ·çš„é”™è¯¯

---

## ğŸ’¡ å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: ä½¿ç”¨ Builder

```dart
home: Builder(
  builder: (context) {
    return appSettings.isGameMode
        ? const GameHomeScreenV12()
        : const HomeScreenV12();
  },
),
```

### æ–¹æ¡ˆ B: ç§»é™¤æ‰€æœ‰ const

```dart
home: appSettings.isGameMode
    ? GameHomeScreenV12()
    : HomeScreenV12(),
```

ä½†éœ€è¦ç¡®ä¿æ„é€ å‡½æ•°ä¸æ˜¯ constã€‚

### æ–¹æ¡ˆ C: ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼çš„é const ç‰ˆæœ¬

```dart
Widget _getHomePage(AppSettings settings) {
  if (settings.isGameMode) {
    return const GameHomeScreenV12();
  } else {
    return const HomeScreenV12();
  }
}

// åœ¨ build ä¸­:
home: _getHomePage(appSettings),
```

---

## ğŸ“ v1.4.0 ä»£ç çŠ¶æ€

### æ–°å¢ç»„ä»¶ (âœ… æ— ç¼–è¯‘é”™è¯¯)

1. `lib/ui/widgets/timer/runner_track.dart` - è·‘é“ç»„ä»¶
2. `lib/ui/widgets/timer/runner_character.dart` - è§’è‰²ç»„ä»¶
3. `lib/ui/widgets/timer/time_background.dart` - æ—¶é—´èƒŒæ™¯
4. `lib/ui/widgets/timer/milestone.dart` - é‡Œç¨‹ç¢‘ç»„ä»¶

### ä¿®æ”¹æ–‡ä»¶

1. `lib/ui/screens/home_screen_v1_2.dart` - âœ… æ— é”™è¯¯
2. `lib/ui/screens/floating_window_screen.dart` - âœ… å·²ä¿®å¤
3. `lib/ui/screens/item_shop_screen.dart` - âœ… å·²ä¿®å¤
4. `lib/main.dart` - âŒ æ„å»ºé”™è¯¯

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### æ¨è: æ–¹æ¡ˆ B (ç§»é™¤ const)

1. æ£€æŸ¥ `GameHomeScreenV12` å’Œ `HomeScreenV12` çš„æ„é€ å‡½æ•°
2. å¦‚æœå®ƒä»¬æ˜¯ const æ„é€ å‡½æ•°ï¼Œæ”¹ä¸ºæ™®é€šæ„é€ å‡½æ•°
3. ç§»é™¤ main.dart ä¸­çš„ const å…³é”®å­—

### å¤‡é€‰: æ–¹æ¡ˆ A (ä½¿ç”¨ Builder)

å¦‚æœæ–¹æ¡ˆ B ä¸è¡Œï¼Œä½¿ç”¨ Builder åŒ…è£…ã€‚

---

## ğŸ“Š æ„å»ºç»Ÿè®¡

```
å°è¯•æ¬¡æ•°: 6æ¬¡
æ¸…ç†æ¬¡æ•°: 2æ¬¡
ä¿®å¤çš„æ–‡ä»¶: 2ä¸ª
å‰©ä½™é—®é¢˜: 1ä¸ª
```

---

## ğŸ”§ è¯Šæ–­å‘½ä»¤

```bash
# æ£€æŸ¥è¯Šæ–­
flutter analyze

# æ¸…ç†æ„å»º
flutter clean

# é‡æ–°è·å–ä¾èµ–
flutter pub get

# æ„å»º
flutter run -d windows
```

---

**åˆ›å»ºæ—¥æœŸ**: 2026-02-26  
**çŠ¶æ€**: âŒ å¾…è§£å†³
