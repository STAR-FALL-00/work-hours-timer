# v3.0 å¿«é€Ÿå‚è€ƒæ‰‹å†Œ

> **å¿«é€ŸæŸ¥é˜…**: å…³é”®ä»£ç ç‰‡æ®µå’Œé…ç½®

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. æ·»åŠ ä¾èµ–

```yaml
# pubspec.yaml
dependencies:
  desktop_multi_window: ^0.2.0
  flutter_acrylic: ^1.1.4
  win32: ^5.0.0
  synchronized: ^3.1.0
  remixicon: ^1.0.0
```

### 2. ä¸»å…¥å£é…ç½®

```dart
// lib/main.dart
void main(List<String> args) async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // åˆ¤æ–­æ˜¯ä¸»çª—å£è¿˜æ˜¯æŒ‚ä»¶çª—å£
  if (args.isEmpty || args.first == 'main') {
    // ä¸»çª—å£
    runApp(MainWindowApp());
  } else if (args.first == 'widget') {
    // æŒ‚ä»¶çª—å£
    runApp(WidgetWindowApp());
  }
}
```

### 3. åˆ›å»ºçª—å£

```dart
// åˆ›å»ºæŒ‚ä»¶çª—å£
final windowId = await DesktopMultiWindow.createWindow(
  jsonEncode({
    'type': 'widget',
    'width': 240,
    'height': 120,
  }),
);
```

---

## ğŸ“¡ è·¨çª—å£é€šä¿¡

### å‘é€æ¶ˆæ¯

```dart
// ä¸»çª—å£ â†’ æŒ‚ä»¶çª—å£
await DesktopMultiWindow.invokeMethod(
  widgetWindowId,
  'onMessage',
  {
    'type': 'UPDATE_TIMER',
    'data': {'duration': 3600, 'status': 'running'},
  },
);
```

### æ¥æ”¶æ¶ˆæ¯

```dart
// æŒ‚ä»¶çª—å£æ¥æ”¶
DesktopMultiWindow.setMethodHandler((call, fromWindowId) async {
  if (call.method == 'onMessage') {
    final message = call.arguments as Map<String, dynamic>;
    final type = message['type'];
    final data = message['data'];
    
    // å¤„ç†æ¶ˆæ¯
    if (type == 'UPDATE_TIMER') {
      setState(() {
        duration = data['duration'];
      });
    }
  }
});
```

---

## ğŸ¨ çª—å£ç‰¹æ•ˆ

### ä¸»çª—å£æ¯›ç»ç’ƒ

```dart
// Windows 11
await Window.setEffect(
  effect: WindowEffect.mica,
  dark: true,
);

// Windows 10
await Window.setEffect(
  effect: WindowEffect.acrylic,
  color: Color(0xCC1A1A2E),
);
```

### æŒ‚ä»¶çª—å£é€æ˜

```dart
// 1. é€æ˜èƒŒæ™¯
await Window.setEffect(
  effect: WindowEffect.transparent,
);

// 2. é¼ æ ‡ç©¿é€
import 'package:win32/win32.dart';

final hwnd = await _getWindowHandle();
final exStyle = GetWindowLongPtr(hwnd, GWL_EXSTYLE);
SetWindowLongPtr(
  hwnd,
  GWL_EXSTYLE,
  exStyle | WS_EX_TRANSPARENT | WS_EX_LAYERED,
);
```

---

## ğŸ¨ UI ç»„ä»¶

### æ˜Ÿè½¨é¢œè‰²

```dart
// ä¸»è‰²è°ƒ
Color(0xFF4A90E2)  // æ˜Ÿè“
Color(0xFFFFD700)  // é‡‘è‰²
Color(0xFFFF6B9D)  // ç²‰è‰²

// èƒŒæ™¯è‰²
Color(0xFF1A1A2E)  // æ·±è“é»‘
Color(0xFF16213E)  // å¡ç‰‡èƒŒæ™¯
```

### å­—ä½“

```dart
// æ•°å­—è®¡æ—¶å™¨
GoogleFonts.orbitron(
  fontSize: 48,
  fontWeight: FontWeight.bold,
)

// æ ‡é¢˜
GoogleFonts.poppins(
  fontSize: 24,
  fontWeight: FontWeight.w600,
)
```

---

## ğŸ“Š æ•°æ®åŒæ­¥

### ä¸»çª—å£å†™å…¥

```dart
// åªæœ‰ä¸»çª—å£å¯ä»¥å†™å…¥
await Hive.box('app_data').put('gold', 1500);

// é€šçŸ¥æŒ‚ä»¶çª—å£
WindowCommunicationService().sendMessage('DATA_UPDATED', {
  'key': 'gold',
  'value': 1500,
});
```

### æŒ‚ä»¶çª—å£è¯»å–

```dart
// æŒ‚ä»¶çª—å£åªè¯»
final gold = Hive.box('app_data').get('gold');
```

---

## ğŸ® åŠ¨ç”»å®ç°

### Sprite åŠ¨ç”»

```dart
class SpriteAnimation extends StatefulWidget {
  final String spritePath;
  final int frameCount;
  final Duration frameDuration;

  @override
  _SpriteAnimationState createState() => _SpriteAnimationState();
}

class _SpriteAnimationState extends State<SpriteAnimation> 
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;
  int _currentFrame = 0;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: widget.frameDuration * widget.frameCount,
      vsync: this,
    )..repeat();
    
    _controller.addListener(() {
      setState(() {
        _currentFrame = (_controller.value * widget.frameCount).floor();
      });
    });
  }

  @override
  Widget build(BuildContext context) {
    return Image.asset(
      '${widget.spritePath}_frame_$_currentFrame.png',
    );
  }
}
```

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### è¿è¡Œåº”ç”¨

```bash
# è¿è¡Œä¸»çª—å£
flutter run -d windows

# çƒ­é‡è½½
r

# çƒ­é‡å¯
R
```

### æ„å»ºå‘å¸ƒç‰ˆ

```bash
flutter build windows --release
```

### åˆ†æä»£ç 

```bash
flutter analyze
```

---

## ğŸ“ æ¶ˆæ¯ç±»å‹é€ŸæŸ¥

| ç±»å‹ | æ–¹å‘ | æ•°æ® | è¯´æ˜ |
|------|------|------|------|
| UPDATE_TIMER | Main â†’ Widget | {duration, status, total} | æ›´æ–°è®¡æ—¶å™¨ |
| UPDATE_RESOURCES | Main â†’ Widget | {gold, exp, level} | æ›´æ–°èµ„æº |
| SWITCH_SKIN | Main â†’ Widget | {skin_id} | åˆ‡æ¢çš®è‚¤ |
| WIDGET_VISIBILITY | Main â†’ Widget | {visible} | æ§åˆ¶æ˜¾éš |
| WIDGET_MOVED | Widget â†’ Main | {x, y} | ä½ç½®å˜åŒ– |
| REQUEST_SHOW_MAIN | Widget â†’ Main | {} | è¯·æ±‚æ˜¾ç¤ºä¸»çª—å£ |

---

## ğŸ¯ æ€§èƒ½ç›®æ ‡

- ä¸»çª—å£ FPS: â‰¥ 60
- æŒ‚ä»¶çª—å£ FPS: â‰¥ 30
- é€šä¿¡å»¶è¿Ÿ: < 100ms
- å†…å­˜å ç”¨: < 200MBï¼ˆæ€»å’Œï¼‰
- å¯åŠ¨æ—¶é—´: < 3s

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: æŒ‚ä»¶çª—å£æ— æ³•ç©¿é€é¼ æ ‡ï¼Ÿ

A: æ£€æŸ¥æ˜¯å¦æ­£ç¡®è®¾ç½®äº† `WS_EX_TRANSPARENT` æ ‡å¿—ã€‚

### Q: ä¸»çª—å£æ¯›ç»ç’ƒæ•ˆæœä¸æ˜¾ç¤ºï¼Ÿ

A: æ£€æŸ¥ Windows ç‰ˆæœ¬ï¼Œç¡®ä¿æ˜¯ Windows 10 1809+ æˆ– Windows 11ã€‚

### Q: è·¨çª—å£é€šä¿¡å»¶è¿Ÿè¿‡é«˜ï¼Ÿ

A: å‡å°‘æ¶ˆæ¯å‘é€é¢‘ç‡ï¼Œæˆ–ä½¿ç”¨æ‰¹é‡å‘é€ã€‚

### Q: å†…å­˜å ç”¨è¿‡é«˜ï¼Ÿ

A: æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼ï¼Œä½¿ç”¨ DevTools åˆ†æã€‚

---

**åˆ›å»ºæ—¥æœŸ**: 2026-02-26  
**ç‰ˆæœ¬**: v3.0  
**ç”¨é€”**: å¼€å‘æ—¶å¿«é€ŸæŸ¥é˜…
